----------- BOARD ------------

root@ebisu:~# mount -t tmpfs -o size=400M tmpfs /tmp
root@ebisu:~# 
root@ebisu:~# dd if=/dev/zero of=/tmp/tmp.img bs=1M count=350
350+0 records in
350+0 records out
367001600 bytes (367 MB, 350 MiB) copied, 3.43741 s, 107 MB/s
root@ebisu:~# 
root@ebisu:~# mkfs.ext3 -L storage /tmp/tmp.img
mke2fs 1.47.0 (5-Feb-2023)
Discarding device blocks:      0/358400             done                            
Creating filesystem with 358400 1k blocks and 89760 inodes
Filesystem UUID: 82f867e7-0fca-438a-af2e-6f8f6c42c259
Superblock backups stored on blocks: 
	8193, 24577, 40961, 57345, 73729, 204801, 221185

Allocating group tables:  0/44     done                            
Writing inode tables:  0/44     done                            
Creating journal (8192 blocks): done
Writing superblocks and filesystem accounting information:  0/44     done

root@ebisu:~# 
root@ebisu:~# modprobe g_mass_storage file=/tmp/tmp.img
[   97.496666] Mass Storage Function, version: 2009/09/11
[   97.502243] LUN: removable file: (no medium)
[   97.511214] LUN: file: /tmp/tmp.img
[   97.515571] Number of LUNs=1
[   97.522159] g_mass_storage gadget: Mass Storage Gadget, version: 2009/09/11
[   97.529711] g_mass_storage gadget: userspace failed to provide iSerialNumber
[   97.537304] g_mass_storage gadget: g_mass_storage ready
root@ebisu:~# 
root@ebisu:~# cat /sys/devices/platform/soc/ee020000.usb/udc/ee020000.usb/s 
tate
root@ebisu
root@ebisu:~# 
---------- HOST-PC -----------

dmesg
[67983.119905] usb 2-2: new SuperSpeed USB device number 13 using xhci_hcd
[67983.140378] usb 2-2: New USB device found, idVendor=0525, idProduct=a4a5, bcdDevice= 5.10
[67983.140383] usb 2-2: New USB device strings: Mfr=3, Product=4, SerialNumber=0
[67983.140385] usb 2-2: Product: Mass Storage Gadget
[67983.140387] usb 2-2: Manufacturer: Linux 5.10.218-yocto-standard with renesas_usb3
[67983.143974] usb-storage 2-2:1.0: USB Mass Storage device detected
[67983.144230] usb-storage 2-2:1.0: Quirks match for vid 0525 pid a4a5: 10000
[67983.144290] scsi host1: usb-storage 2-2:1.0
[67984.165540] scsi 1:0:0:0: Direct-Access     Linux    File-Stor Gadget 0510 PQ: 0 ANSI: 2
[67984.166372] sd 1:0:0:0: Attached scsi generic sg1 type 0
[67984.166832] sd 1:0:0:0: Power-on or device reset occurred
[67984.167712] sd 1:0:0:0: [sdb] 716800 512-byte logical blocks: (367 MB/350 MiB)
[67984.274350] sd 1:0:0:0: [sdb] Write Protect is off
[67984.274354] sd 1:0:0:0: [sdb] Mode Sense: 0f 00 00 00
[67984.382175] sd 1:0:0:0: [sdb] Write cache: enabled, read cache: enabled, doesn't support DPO or FUA
[67984.817903] sd 1:0:0:0: [sdb] Attached SCSI disk
[67985.147654] EXT4-fs (sdb): mounting ext3 file system using the ext4 subsystem
[67985.155849] EXT4-fs (sdb): mounted filesystem with ordered data mode. Opts: (null). Quota mode: none.

df -h
Filesystem      Size  Used Avail Use% Mounted on
udev            3,8G     0  3,8G   0% /dev
tmpfs           784M  2,4M  781M   1% /run
/dev/nvme0n1p4  458G  383G   52G  89% /
tmpfs           3,9G     0  3,9G   0% /dev/shm
tmpfs           5,0M  4,0K  5,0M   1% /run/lock
tmpfs           3,9G     0  3,9G   0% /sys/fs/cgroup
/dev/loop0      128K  128K     0 100% /snap/bare/5
/dev/loop3      384K  384K     0 100% /snap/device-tree-compiler/91
/dev/loop2       64M   64M     0 100% /snap/core20/2182
/dev/loop1       64M   64M     0 100% /snap/core20/2318
/dev/loop4      506M  506M     0 100% /snap/gnome-42-2204/176
/dev/loop5       75M   75M     0 100% /snap/core22/1439
/dev/loop6       12M   12M     0 100% /snap/nmap/3470
/dev/loop7      350M  350M     0 100% /snap/gnome-3-38-2004/143
/dev/loop12      12M   12M     0 100% /snap/nmap/3514
/dev/loop17     347M  347M     0 100% /snap/gnome-3-38-2004/119
/dev/loop9       13M   13M     0 100% /snap/snap-store/1113
/dev/loop18      56M   56M     0 100% /snap/core18/2829
/dev/loop10      39M   39M     0 100% /snap/snapd/21759
/dev/loop14     9,8M  9,8M     0 100% /snap/htop/4407
/dev/loop16     497M  497M     0 100% /snap/gnome-42-2204/141
/dev/loop11      41M   41M     0 100% /snap/snapd/20290
/dev/loop8       75M   75M     0 100% /snap/core22/1380
/dev/loop13      13M   13M     0 100% /snap/snap-store/959
/dev/loop15      92M   92M     0 100% /snap/gtk-common-themes/1535
/dev/nvme0n1p1  3,7G  210M  3,3G   6% /boot
/dev/nvme0n1p2  3,9G  6,1M  3,9G   1% /boot/efi
tmpfs           784M   24K  784M   1% /run/user/1000
/dev/sdb        318M   47K  301M   1% /media/rvc/storage

dd if=/dev/urandom of=./file-300M bs=1M count=300
300+0 records in
300+0 records out
314572800 bytes (315 MB, 300 MiB) copied, 1,55759 s, 202 MB/s

sudo cp ./file-300M /media/rvc/storage

md5sum ./file-300M /media/rvc/storage/file-300M
8f444cb2abede230ab7d75fa48d0df4c  ./file-300M
8f444cb2abede230ab7d75fa48d0df4c  /media/rvc/storage/file-300M

sudo umount /media/rvc/storage

----------- BOARD ------------
root@ebisu
root@ebisu:~# rmmod g_mass_storage
root@ebisu:~# 
root@ebisu:~# rm -rf /tmp/tmp.img
root@ebisu:~# 

---------- HOST-PC -----------

dmesg
[67992.776256] usb 1-1.1: new full-speed USB device number 18 using xhci_hcd
[67992.879195] usb 1-1.1: New USB device found, idVendor=10c4, idProduct=ea60, bcdDevice= 1.00
[67992.879211] usb 1-1.1: New USB device strings: Mfr=1, Product=2, SerialNumber=3
[67992.879218] usb 1-1.1: Product: CP2102 USB to UART Bridge Controller
[67992.879223] usb 1-1.1: Manufacturer: Silicon Labs
[67992.879229] usb 1-1.1: SerialNumber: 0001
[67992.887205] cp210x 1-1.1:1.0: cp210x converter detected
[67992.890637] usb 1-1.1: cp210x converter now attached to ttyUSB0
[67994.833682] usb 2-2: USB disconnect, device number 13
[67994.860089] sd 1:0:0:0: [sdb] Synchronizing SCSI cache
[67994.860218] sd 1:0:0:0: [sdb] Synchronize Cache(10) failed: Result: hostbyte=DID_NO_CONNECT driverbyte=DRIVER_OK

 
#### Result: OK ####
